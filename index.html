<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>File Uploader — Catbox.moe</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f5f6fa;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }
    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
      padding: 20px;
      width: 90%;
      max-width: 420px;
    }
    h1 {
      font-size: 18px;
      margin-bottom: 12px;
    }
    .drop {
      border: 2px dashed #d0d7ff;
      padding: 20px;
      text-align: center;
      color: #555;
      border-radius: 10px;
      margin-bottom: 12px;
      cursor: pointer;
      background: #fafcff;
      transition: background .3s;
    }
    .drop.dragover {
      background: #eef5ff;
    }
    .btn {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
    }
    .btn:disabled {
      opacity: .6;
      cursor: not-allowed;
    }
    .progress {
      height: 8px;
      background: #e4ebf7;
      border-radius: 6px;
      margin-top: 10px;
      overflow: hidden;
    }
    .bar {
      height: 100%;
      background: #007bff;
      width: 0%;
      transition: width .2s;
    }
    pre {
      background: #0f172a;
      color: #e2e8f0;
      padding: 10px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>File Uploader — Catbox.moe</h1>
    <div id="drop" class="drop">Tarik & letakkan file di sini atau klik untuk pilih</div>
    <input id="fileInput" type="file" style="display:none">
    <button id="uploadBtn" class="btn">Upload</button>
    <div class="progress"><div id="bar" class="bar"></div></div>
    <p id="status" style="font-size:13px;color:#555;margin-top:8px"></p>
    <h3 style="font-size:14px;margin-top:12px">Response:</h3>
    <pre id="result">Belum ada hasil.</pre>
  </div>

  <script>
    const ENDPOINT = "https://catbox.moe/user/api.php";
    const drop = document.getElementById('drop');
    const fileInput = document.getElementById('fileInput');
    const uploadBtn = document.getElementById('uploadBtn');
    const bar = document.getElementById('bar');
    const status = document.getElementById('status');
    const result = document.getElementById('result');
    let selectedFile = null;

    drop.addEventListener('click', () => fileInput.click());
    drop.addEventListener('dragover', e => {
      e.preventDefault();
      drop.classList.add('dragover');
    });
    drop.addEventListener('dragleave', e => {
      e.preventDefault();
      drop.classList.remove('dragover');
    });
    drop.addEventListener('drop', e => {
      e.preventDefault();
      drop.classList.remove('dragover');
      if (e.dataTransfer.files.length > 0) {
        selectedFile = e.dataTransfer.files[0];
        drop.textContent = `Dipilih: ${selectedFile.name} — ${formatBytes(selectedFile.size)}`;
      }
    });
    fileInput.addEventListener('change', e => {
      selectedFile = e.target.files[0];
      if (selectedFile) {
        drop.textContent = `Dipilih: ${selectedFile.name} — ${formatBytes(selectedFile.size)}`;
      }
    });

    uploadBtn.addEventListener('click', async () => {
      if (!selectedFile) return alert('Pilih file terlebih dahulu!');
      uploadBtn.disabled = true;
      bar.style.width = '0%';
      result.textContent = 'Mengupload...';
      status.textContent = 'Sedang mengupload...';

      const formData = new FormData();
      formData.append('reqtype', 'fileupload');
      formData.append('fileToUpload', selectedFile);

      try {
        const xhr = new XMLHttpRequest();
        xhr.open("POST", ENDPOINT, true);
        xhr.upload.onprogress = e => {
          if (e.lengthComputable) {
            const pct = Math.round((e.loaded / e.total) * 100);
            bar.style.width = pct + '%';
            status.textContent = `Progress: ${pct}%`;
          }
        };
        xhr.onload = () => {
          uploadBtn.disabled = false;
          if (xhr.status === 200) {
            bar.style.width = '100%';
            const url = xhr.responseText.trim();
            if (url.startsWith("http")) {
              result.textContent = url;
              result.style.color = '#00ff88';
            } else {
              result.textContent = 'Error:\n' + url;
              result.style.color = '#ff5555';
            }
            status.textContent = 'Selesai';
          } else {
            result.textContent = 'Upload gagal: ' + xhr.status;
            result.style.color = '#ff5555';
            status.textContent = 'Gagal';
          }
        };
        xhr.onerror = () => {
          uploadBtn.disabled = false;
          status.textContent = 'Kesalahan jaringan.';
        };
        xhr.send(formData);
      } catch (err) {
        uploadBtn.disabled = false;
        result.textContent = 'Error: ' + err.message;
      }
    });

    function formatBytes(bytes) {
      if (bytes === 0) return '0 B';
      const k = 1024;
      const sizes = ['B','KB','MB','GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
  </script>
</body>
</html>
